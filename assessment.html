<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آزمون تعیین سطح هوشمند | موسسه ورسک</title>
    
    <!-- Fonts -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --secondary: #db2777;
            --accent: #06b6d4;
            --success: #10b981;
            
            --bg-body: #0f172a;
            --bg-surface: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.7);
            
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            
            --radius: 16px;
            --radius-sm: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazir', sans-serif; outline: none; }
        
        body {
            background-color: var(--bg-body);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(79, 70, 229, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(219, 39, 119, 0.15) 0%, transparent 50%);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- Header --- */
        .header { text-align: center; padding: 2rem 0; }
        .brand {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        /* --- Card Container --- */
        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        /* --- Auth Form Styles --- */
        .form-title { font-size: 1.5rem; margin-bottom: 1.5rem; text-align: center; color: var(--text-main); }
        
        .form-group { margin-bottom: 1.2rem; text-align: right; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem; }
        
        .input-field {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 1rem;
            transition: 0.3s;
        }
        .input-field:focus { border-color: var(--primary); background: rgba(0, 0, 0, 0.4); }
        
        .btn-primary {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(79, 70, 229, 0.6); }

        /* --- Quiz Styles --- */
        .section-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(6, 182, 212, 0.15);
            color: var(--accent);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .progress-container {
            background: rgba(255,255,255,0.05);
            height: 6px;
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .progress-bar { height: 100%; background: var(--success); width: 0%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        .question-text { font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; line-height: 1.7; text-align: left; direction: ltr; }
        
        /* Reading Section */
        .reading-box {
            background: rgba(0,0,0,0.2);
            border-left: 4px solid var(--accent);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            direction: ltr;
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-muted);
        }
        .reading-box::-webkit-scrollbar { width: 6px; }
        .reading-box::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .options-grid { display: grid; gap: 0.8rem; }
        .option-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 10px;
            color: var(--text-main);
            text-align: left;
            direction: ltr;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .option-btn:hover { background: rgba(255,255,255,0.08); border-color: var(--primary); }
        .option-btn.selected { background: var(--primary); border-color: var(--primary); color: white; }

        /* --- Results --- */
        .result-header { text-align: center; margin-bottom: 2rem; }
        .level-circle {
            width: 120px; height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, transparent 0%);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 1rem;
            position: relative;
            box-shadow: 0 0 30px rgba(79, 70, 229, 0.3);
        }
        .level-circle::after {
            content: attr(data-level);
            width: 100px; height: 100px;
            background: var(--bg-surface);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; font-weight: 900; color: white;
        }

        .course-card {
            background: linear-gradient(180deg, rgba(79, 70, 229, 0.1) 0%, rgba(30, 41, 59, 0) 100%);
            border: 1px solid var(--primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: right;
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
            text-decoration: none;
            padding: 1rem;
            border-radius: var(--radius-sm);
            display: flex; align-items: center; justify-content: center; gap: 10px;
            font-weight: bold;
            transition: 0.3s;
        }
        .whatsapp-btn:hover { background: #1ebc57; transform: translateY(-2px); }

        /* Utilities */
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media(max-width: 600px) {
            .card { padding: 1.5rem; }
            .brand { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <div class="brand">موسسه ورسک</div>
            <p style="color: var(--text-muted);">سیستم هوشمند تعیین سطح و مشاوره</p>
        </header>

        <!-- VIEW 1: Registration / Login -->
        <div id="view-auth" class="card fade-in">
            <h2 class="form-title">شروع فرایند تعیین سطح</h2>
            <p style="text-align: center; margin-bottom: 2rem; color: var(--text-muted); font-size: 0.9rem;">
                برای دریافت کارنامه دقیق و ذخیره سوابق، لطفا مشخصات خود را وارد کنید.
            </p>
            
            <form id="authForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>نام</label>
                    <input type="text" id="firstName" class="input-field" placeholder="مثال: علی" required>
                </div>
                <div class="form-group">
                    <label>نام خانوادگی</label>
                    <input type="text" id="lastName" class="input-field" placeholder="مثال: محمدی" required>
                </div>
                <div class="form-group">
                    <label>شماره تماس (جهت ارسال نتایج)</label>
                    <input type="tel" id="phone" class="input-field" placeholder="0912..." pattern="[0-9]{11}" required>
                </div>
                <div class="form-group">
                    <label>تاریخ تولد</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <input type="number" id="birthDay" class="input-field" placeholder="روز" min="1" max="31" required>
                        <input type="number" id="birthMonth" class="input-field" placeholder="ماه" min="1" max="12" required>
                        <input type="number" id="birthYear" class="input-field" placeholder="سال" min="1300" max="1400" required>
                    </div>
                </div>
                <button type="submit" class="btn-primary">ثبت اطلاعات و شروع آزمون</button>
            </form>
        </div>

        <!-- VIEW 2: Quiz Interface -->
        <div id="view-quiz" class="card hidden">
            <div class="progress-container">
                <div class="progress-bar" id="quiz-progress"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="section-badge" class="section-badge">بخش عمومی</span>
                <span id="q-counter" style="color: var(--text-muted); font-size: 0.9rem;">1/20</span>
            </div>

            <!-- Reading Section Container (Only visible for reading questions) -->
            <div id="reading-container" class="reading-box hidden">
                <h4 style="color: var(--text-main); margin-bottom: 0.5rem;">Read the article:</h4>
                <p id="article-text">Loading article...</p>
            </div>

            <h3 class="question-text" id="q-text">Question text goes here?</h3>
            
            <div class="options-grid" id="options-box">
                <!-- Options injected via JS -->
            </div>
        </div>

        <!-- VIEW 3: Results -->
        <div id="view-result" class="card hidden">
            <div class="result-header">
                <h2 style="margin-bottom: 0.5rem;">کارنامه نهایی</h2>
                <p style="color: var(--text-muted);">دانش‌پذیر: <span id="user-name-display" style="color: var(--text-main); font-weight: bold;">-</span></p>
            </div>

            <div class="level-circle" id="level-badge" data-level="B1"></div>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <h3 id="level-title" style="font-size: 1.5rem; color: var(--primary);">متوسط (Intermediate)</h3>
                <p id="level-desc" style="color: var(--text-muted); margin-top: 0.5rem; font-size: 0.9rem;">شما توانایی برقراری ارتباط در موقعیت‌های روزمره را دارید.</p>
            </div>

            <div class="course-card">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                    <i class="fas fa-graduation-cap" style="color: var(--secondary); font-size: 1.5rem;"></i>
                    <div>
                        <small style="color: var(--text-muted);">دوره پیشنهادی هوشمند</small>
                        <h4 id="course-name" style="font-size: 1.2rem;">دوره مکالمه پیشرفته</h4>
                    </div>
                </div>
                <p id="course-desc" style="color: var(--text-muted); font-size: 0.95rem; line-height: 1.6;">
                    این دوره بر اساس نقاط ضعف شما در گرامر پیشرفته و درک مطلب طراحی شده است.
                </p>
            </div>

            <p style="text-align: center; margin-bottom: 1rem; font-size: 0.9rem;">
                اطلاعات شما در سیستم ورسک ثبت شد. برای نهایی کردن ثبت‌نام و دریافت برنامه کلاسی، به مشاور پیام دهید:
            </p>
            
            <a href="https://wa.me/989331636454" class="whatsapp-btn">
                <i class="fab fa-whatsapp" style="font-size: 1.4rem;"></i>
                مشاوره و دریافت برنامه (09331636454)
            </a>
            <a href="index.html" style="display: block; text-align: center; margin-top: 1.5rem; color: var(--text-muted); font-size: 0.9rem;">بازگشت به خانه</a>
        </div>
    </div>

    <script>
        // --- DATABASE ---
        
        // Part 1: General Questions (Grammar & Vocab) - Mix of levels
        const generalQuestions = [
            { text: "I _____ a student.", options: ["is", "are", "am", "be"], correct: 2, level: "A1" },
            { text: "She _____ to the park yesterday.", options: ["go", "went", "gone", "going"], correct: 1, level: "A1" },
            { text: "Can you give me _____ water?", options: ["a", "an", "some", "any"], correct: 2, level: "A2" },
            { text: "This book is _____ than that one.", options: ["good", "better", "best", "gooder"], correct: 1, level: "A2" },
            { text: "I have been living here _____ 2010.", options: ["since", "for", "ago", "in"], correct: 0, level: "B1" },
            { text: "If it rains, we _____ stay at home.", options: ["would", "will", "did", "had"], correct: 1, level: "B1" },
            { text: "The man _____ car was stolen called the police.", options: ["who", "which", "whose", "whom"], correct: 2, level: "B1" },
            { text: "I look forward _____ you soon.", options: ["to see", "seeing", "to seeing", "see"], correct: 2, level: "B2" },
            { text: "The meeting was _____ due to heavy snow.", options: ["called off", "called in", "called out", "called for"], correct: 0, level: "B2" },
            { text: "I wish I _____ harder for the exam.", options: ["study", "have studied", "had studied", "would study"], correct: 2, level: "B2" },
            { text: "Scarcely had he arrived _____ the phone rang.", options: ["when", "than", "then", "after"], correct: 0, level: "C1" },
            { text: "The government is contemplating _____ taxes.", options: ["to raise", "raising", "raise", "to raising"], correct: 1, level: "C1" },
            { text: "Despite _____ tired, he continued working.", options: ["he was", "of being", "being", "be"], correct: 2, level: "C1" },
            { text: "It's high time you _____ a job.", options: ["find", "found", "have found", "will find"], correct: 1, level: "C1" }
        ];

        // Part 2: Reading Comprehension
        const readingPassage = {
            id: "tech_01",
            title: "The Impact of AI",
            text: "Artificial Intelligence (AI) is rapidly transforming industries across the globe. From healthcare, where algorithms analyze medical images with increasing accuracy, to finance, where AI models predict market trends, the technology is becoming ubiquitous. However, this rapid advancement raises ethical concerns. Issues such as data privacy, algorithmic bias, and job displacement are at the forefront of discussions among policymakers. While proponents argue that AI will create more jobs than it destroys by streamlining repetitive tasks, critics worry about the widening gap between skilled and unskilled labor.",
            questions: [
                { text: "What is the main idea of the passage?", options: ["AI is only useful in healthcare.", "AI brings benefits but also raises ethical concerns.", "AI will destroy all jobs.", "Finance is the only industry using AI."], correct: 1, level: "B2" },
                { text: "According to the text, why do critics worry?", options: ["AI is too slow.", "AI cannot analyze images.", "The gap between skilled and unskilled labor might widen.", "Policymakers are not discussing AI."], correct: 2, level: "B2" },
                { text: "The word 'ubiquitous' in the text is closest in meaning to:", options: ["Rare", "Expensive", "Everywhere", "Dangerous"], correct: 2, level: "C1" },
                { text: "Proponents of AI suggest that:", options: ["It will streamline repetitive tasks.", "It will cause job losses only.", "It should be banned.", "It is not accurate."], correct: 0, level: "B2" }
            ]
        };

        // Courses Info
        const courses = {
            'A1': { name: "دوره جامع استارتر (Starter)", desc: "شروع از صفر مطلق. تمرکز بر الفبا، اعداد و جملات پایه." },
            'A2': { name: "دوره مکالمه مقدماتی (Elementary)", desc: "یادگیری مکالمات روزمره، خرید، سفر و گرامر پایه." },
            'B1': { name: "دوره متوسطه (Pre-Intermediate)", desc: "افزایش دامنه لغات و توانایی صحبت درباره موضوعات انتزاعی." },
            'B2': { name: "دوره پیشرفته (Upper-Intermediate)", desc: "آمادگی برای محیط‌های کاری بین‌المللی و تماشای فیلم بدون زیرنویس." },
            'C1': { name: "دوره تخصصی آیلتس/تافل", desc: "تکنیک‌های آزمون، رایتینگ آکادمیک و متون پیچیده." }
        };

        // --- STATE ---
        let userProfile = {};
        let currentQIndex = 0;
        let score = 0;
        let totalPossibleScore = 0; // Weighted score tracking
        let quizPhase = 'general'; // 'general' or 'reading'
        let activeQuestions = [];

        // --- FUNCTIONS ---

        function handleRegister(e) {
            e.preventDefault();
            
            // Save User Data
            userProfile = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value,
                birthDate: `${document.getElementById('birthYear').value}/${document.getElementById('birthMonth').value}/${document.getElementById('birthDay').value}`
            };

            // Simple LocalStorage Save (Simulating Login)
            localStorage.setItem('veresk_user', JSON.stringify(userProfile));

            // Switch View
            document.getElementById('view-auth').classList.add('hidden');
            document.getElementById('view-quiz').classList.remove('hidden');
            document.getElementById('view-quiz').classList.add('fade-in');

            startQuiz();
        }

        function startQuiz() {
            // Initialize General Section
            quizPhase = 'general';
            activeQuestions = generalQuestions;
            currentQIndex = 0;
            renderQuestion();
        }

        function renderQuestion() {
            // Check if we need to switch to Reading Phase
            if (quizPhase === 'general' && currentQIndex >= activeQuestions.length) {
                quizPhase = 'reading';
                activeQuestions = readingPassage.questions;
                currentQIndex = 0;
                
                // Show Reading UI
                const readingBox = document.getElementById('reading-container');
                readingBox.classList.remove('hidden');
                readingBox.classList.add('fade-in');
                document.getElementById('article-text').innerText = readingPassage.text;
                document.getElementById('section-badge').innerText = "بخش درک مطلب (Reading)";
                document.getElementById('section-badge').style.background = "rgba(236, 72, 153, 0.15)";
                document.getElementById('section-badge').style.color = "var(--secondary)";
            }

            // Check End of Quiz
            if (quizPhase === 'reading' && currentQIndex >= activeQuestions.length) {
                finishQuiz();
                return;
            }

            const q = activeQuestions[currentQIndex];
            
            // Update Counters
            const totalQs = generalQuestions.length + readingPassage.questions.length;
            const absoluteIndex = quizPhase === 'general' ? currentQIndex : generalQuestions.length + currentQIndex;
            document.getElementById('q-counter').innerText = `${absoluteIndex + 1}/${totalQs}`;
            
            const progressPct = ((absoluteIndex) / totalQs) * 100;
            document.getElementById('quiz-progress').style.width = `${progressPct}%`;

            // Render Text & Options
            document.getElementById('q-text').innerText = q.text;
            const optionsBox = document.getElementById('options-box');
            optionsBox.innerHTML = '';

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                
                // Add A, B, C, D labels for better readability
                const label = String.fromCharCode(65 + idx); // A, B, C...
                btn.innerHTML = `<span style="font-weight:bold; color:var(--primary); min-width:20px;">${label}.</span> ${opt}`;
                
                btn.onclick = () => handleAnswer(idx, q);
                optionsBox.appendChild(btn);
            });
        }

        function handleAnswer(selectedIndex, question) {
            // Calculate Weighted Score
            let weight = 1;
            if (question.level === 'B1' || question.level === 'B2') weight = 2;
            if (question.level === 'C1') weight = 3;
            
            totalPossibleScore += weight;

            if (selectedIndex === question.correct) {
                score += weight;
                // UI Feedback (Green)
                event.target.closest('.option-btn').style.background = 'rgba(16, 185, 129, 0.2)';
                event.target.closest('.option-btn').style.borderColor = '#10b981';
            } else {
                // UI Feedback (Red)
                event.target.closest('.option-btn').style.background = 'rgba(239, 68, 68, 0.2)';
                event.target.closest('.option-btn').style.borderColor = '#ef4444';
            }

            // Delay for UX
            setTimeout(() => {
                currentQIndex++;
                renderQuestion();
            }, 600);
        }

        function finishQuiz() {
            document.getElementById('view-quiz').classList.add('hidden');
            document.getElementById('view-result').classList.remove('hidden');
            document.getElementById('view-result').classList.add('fade-in');

            // Fill User Name
            document.getElementById('user-name-display').innerText = `${userProfile.firstName} ${userProfile.lastName}`;

            // Calculate Percentage
            const finalPct = (score / totalPossibleScore) * 100;
            
            let level = 'A1';
            let color = '#10b981'; // green
            
            if (finalPct > 20) level = 'A2';
            if (finalPct > 40) { level = 'B1'; color = '#06b6d4'; } // cyan
            if (finalPct > 65) { level = 'B2'; color = '#4f46e5'; } // indigo
            if (finalPct > 85) { level = 'C1'; color = '#db2777'; } // pink

            // Update UI Elements
            const badge = document.getElementById('level-badge');
            badge.setAttribute('data-level', level);
            badge.style.background = `conic-gradient(${color} ${finalPct}%, transparent 0%)`;
            
            // Update Titles
            document.getElementById('level-title').style.color = color;
            
            const course = courses[level];
            document.getElementById('level-title').innerText = course.name.split(' (')[0];
            document.getElementById('level-desc').innerText = course.desc; // Using desc as subtitle too
            
            document.getElementById('course-name').innerText = course.name;
            document.getElementById('course-desc').innerText = course.desc;
        }

        // Check for existing login (Optional feature)
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('veresk_user');
            if(savedUser) {
                const u = JSON.parse(savedUser);
                document.getElementById('firstName').value = u.firstName;
                document.getElementById('lastName').value = u.lastName;
                document.getElementById('phone').value = u.phone;
                // We could auto-login, but for "Assessment" usually people want to re-take or register fresh.
                // So we just pre-fill but don't auto-start.
            }
        });

    </script>
</body>
</html>
